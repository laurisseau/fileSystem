trigger:
  - main

pool:
  name: 'testagentpool'

jobs:
  - job: buildGoJob
    steps:
      - task: GoTool@0
        inputs:
          version: '1.23.5'

      - script: go build -o $(Build.ArtifactStagingDirectory)\filesystem.exe
        displayName: 'Build Go Project'

      - task: PublishBuildArtifacts@1
        inputs:
          artifactName: 'drop'
          targetPath: $(Build.ArtifactStagingDirectory)
          publishLocation: 'Container'

  - job: DeployFile
    steps:
    - task: CopyFilesOverSSH@0
      inputs:
        sshEndpoint: 'testsshserviceconnection'  # The name of the SSH service connection
        sourceFolder: '$(Build.ArtifactStagingDirectory)\filesystem.exe'  # Path to the file you want to upload
        targetFolder: '/home/laurisseau/filesystem/'  # Directory on the Azure Linux VM where you want to upload the file
        cleanTargetFolder: true  # Set to true if you want to clean the target directory before uploading

    - script: |
        echo "File uploaded successfully"