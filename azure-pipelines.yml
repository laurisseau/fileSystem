trigger:
  - main

pool:
  name: 'testagentpool'

jobs:
  - job: buildGoJob
    steps:
      - task: GoTool@0
        inputs:
          version: '1.23.5'

      - script: go build -o $(Build.ArtifactStagingDirectory)/filesystem.exe
        displayName: 'Build Go Project'

      - task: PublishBuildArtifacts@1
        inputs:
          artifactName: 'drop'
          targetPath: $(Build.ArtifactStagingDirectory)
          publishLocation: 'Container'

  - job: deployJob
    dependsOn: buildGoJob
    steps:
      - task: SSH@0
        inputs:
          sshEndpoint: 'testsshserviceconnection'  # Replace with your service connection name
          runOptions: 'inline'
          inline: |
            cd /home/laurisseau/filesystem/  # Update with the directory where you want to deploy
            rm -f filesystem.exe  # Remove the old file if it exists
            mv $(Build.ArtifactStagingDirectory)/filesystem.exe .  # Deploy new executable
            ./filesystem.exe  # Start the application or do any post-deploy tasks